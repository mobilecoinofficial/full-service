# Testing for Full Service Mirror

## Build binaries

We suggest building full service in the `./mob prompt` standard docker build environment.

### Update mobilecoin Submodule

In the root of the repo pull down the current `mobilecoin` submodule.

```
git submodule update --init
```

### Start docker build environment with `./mob prompt`

From the root of the repo start the `mob` docker environment. The mob script will pull down the current build environment and set up your user and the repo in the container.

See `./mob --help` for additional options.

```
âžœ ./mob prompt

<user>@<container-id>:/tmp/mobilenode$
```

### Build full-service project binaries

Use the `./tools/build-fs.sh` script to build all the project binaries for a specific mobilecoin network. This will build `full-service`, `wallet-service-mirror-public`, `wallet-service-mirror-private` and other support binaries.

See `./tools/build-fs.sh --help` for usage and additional options.

```
# for testnet builds
<user>@<container-id>:/tmp/mobilenode$ ./tools/build-fs.sh --network test

# for mainnet builds
<user>@<container-id>:/tmp/mobilenode$ ./tools/build-fs.sh --network main
```

### Start the full-service and public/private mirror binaries

Use the `./start.sh` helper script with the same `--network` option you built with, to set up the required certificates and encryption keys and start the required binaries for testing.

See `./start.sh --help` for full usage.

```
<user>@<container-id>:/tmp/mobilenode$ cd mirror/test
<user>@<container-id>:/tmp/mobilenode/mirror/test$ ./start.sh --network test
```

### Run nodejs test suite

Run the `test.sh` helper script and provide a wallet mnemonic that has some funds for testing.

```
<user>@<container-id>:/tmp/mobilenode/mirror/test$ ./test.sh --mnemonic '<24 words>'
```

### Stop services

Run the `stop.sh` script to kill all the running full-service and mirror services.

```
<user>@<container-id>:/tmp/mobilenode/mirror/test$ ./stop.sh
```

# Development

Make sure you have nodejs 16+ installed and use `npm install` to load the modules required for `mirror-client.js` and `mirror-test.js`

```
npm install
```

Use `eslint` with "standard" style guide to check syntax style. Most IDEs will pick up the settings from the included `.eslintrc.js`

# Example Client Usage

See `node mirror-client.js --help` for full usage.

You will need the `mirror-client.pem` public key file generated by the `generate-rsa-keypair` utility to communicate with the mirror public endpoint.

See [Full-Service API Reference](https://mobilecoin.gitbook.io/full-service-api/api-endpoints/v2) for available routes.

```
# install modules - if running from a freshly cloned repo
npm install

# run mirror-client.js
node mirror-client.js --public-mirror-url http://127.0.0.1:9091 \
    --key-file /tmp/mirror_test/mirror-client.pem \
    --request '{ "method": "get_accounts", "params": {}, "jsonrpc": "2.0", "id": 1 }'
```

# Test suite usage

See `node mirror-test.js --help` for full usage.

### Prerequisites

- The `mirror-client.pem` public key file generated by the `generate-rsa-keypair` utility to communicate with the mirror public endpoint.
- full-service with a preloaded account that has a balance

    OR

    Provide the optional 24 words mnemonic and the direct full-service endpoint.

    `--full-service-url http://127.0.0.1:9090 --mnemonic <24 words>`

### Run

```
# install modules - if running from a freshly cloned repo
npm install

# With preloaded account - no direct full-service access
node mirror-test.js --public-mirror-url http://127.0.0.1:9091 \
    --key-file /tmp/mirror_test/mirror-client.pem

# With direct full-service access
node mirror-test.js --public-mirror-url http://127.0.0.1:9091 \
    --key-file /tmp/mirror_test/mirror-client.pem \
    --full-service-url http://127.0.0.1:9090 \
    --mnemonic '<24 words>'
```

